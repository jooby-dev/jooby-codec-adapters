// IMPORTANT!!!
// This example only for default downlink data converter.
// Data converters for other integrations use different input and result.
// Find example of uplink data converter for your integration and edit usage of payload and result
// Integrations list: https://thingsboard.io/docs/user-guide/integrations/

// encoded message should be less than this size
// to be able to send to a device
var MAX_DATA_SEGMENT_SIZE = 50;


//#region [autogenerated jooby-codec bundle from index.js]
var toBytes,setDataSegment,getBase64FromBytes;(function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=Array(e);r<e;r++)a[r]=t[r];return a}function e(e){if(Array.isArray(e))return t(e)}function r(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(t){return e(t)||r(t)||i(t)||a()}function i(e,r){if(e){if("string"==typeof e)return t(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}}var v=1;var s=2;var _=3;var E=4;var o=Math.log,f=Math.pow,u=Math.LN2;var A=function(t,e,r,a,n){var i,v,s=n*8-a-1,_=(1<<s)-1,E=_>>1,o=-7,u=r?n-1:0,A=r?-1:1,T=t[e+u];u+=A;i=T&(1<<-o)-1;T>>=-o;o+=s;for(;o>0;i=i*256+t[e+u],u+=A,o-=8);v=i&(1<<-o)-1;i>>=-o;o+=a;for(;o>0;v=v*256+t[e+u],u+=A,o-=8);if(i===0){i=1-E}else if(i===_){return v?NaN:T?-Infinity:Infinity}else{v=v+f(2,a);i=i-E}return(T?-1:1)*v*f(2,i-a)};var T=function(t,e,r,a,n,i){var v,s,_,E=i*8-n-1,A=(1<<E)-1,T=A>>1,R=n===23?f(2,-24)-f(2,-77):0,O=a?0:i-1,d=a?1:-1,c=r<0||r===0&&1/r<0?1:0;r<0&&(r=-r);if(r!==r||r===Infinity){s=r!==r?1:0;v=A}else{v=o(r)/u|0;if(r*(_=f(2,-v))<1){v--;_*=2}if(v+T>=1){r+=R/_}else{r+=R*f(2,1-T)}if(r*_>=2){v++;_/=2}if(v+T>=A){s=0;v=A}else if(v+T>=1){s=(r*_-1)*f(2,n);v=v+T}else{s=r*f(2,T-1)*f(2,n);v=0}}for(;n>=8;t[e+O]=s&255,O+=d,s/=256,n-=8);v=v<<n|s;E+=n;for(;E>0;t[e+O]=v&255,O+=d,v/=256,E-=8);t[e+O-d]|=c*128};var R=[1,0];var O=[2,1,0];var d=[3,2,1,0];var c=[0,1];var l=[0,1,2];var h=[0,1,2,3];var N=function(t,e){return t[e]};var U=function(t,e,r){var a=r?c:R;var n=t[e+a[0]];var i=t[e+a[1]]<<8;return n|i};var S=function(t,e,r){var a=r?l:O;var n=t[e+a[0]];var i=t[e+a[1]]<<8;var v=t[e+a[2]]<<16;return n|i|v};var D=function(t,e,r){var a=r?h:d;var n=t[e+a[3]]*16777216;var i=t[e+a[2]]*65536;var v=t[e+a[1]]*256;var s=t[e+a[0]];return n+i+v+s};var I=function(t,e,r){t[e]=r&255};var g=function(t,e,r,a){var n=a?c:R;t[e+n[0]]=r&255;t[e+n[1]]=r>>>8&255};var L=function(t,e,r,a){var n=a?l:O;t[e+n[0]]=r&255;t[e+n[1]]=r>>>8&255;t[e+n[2]]=r>>>16&255};var C=function(t,e,r,a){var n=a?h:d;t[e+n[0]]=r&255;t[e+n[1]]=r>>>8&255;t[e+n[2]]=r>>>16&255;t[e+n[3]]=r>>>24&255};function P(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(typeof t==="number"){var r=new Array(t).fill(0);this.data=r}else{this.data=t}this.offset=0;this.isLittleEndian=e}P.prototype={toUint8Array:function(){return this.data},seek:function(t){if(t<0||t>=this.data.length){throw new Error("Invalid position.")}this.offset=t},setInt8:function(t){I(this.data,this.offset,t<0?t|256:t);this.offset+=v},getInt8:function(){var t=N(this.data,this.offset);this.offset+=v;return t&128?t^-256:t},setUint8:function(t){I(this.data,this.offset,t);this.offset+=v},getUint8:function(){var t=N(this.data,this.offset);this.offset+=v;return t},setInt16:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;g(this.data,this.offset,t<0?t|65536:t,e);this.offset+=s},getInt16:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=U(this.data,this.offset,t);this.offset+=s;return e&32768?e^-65536:e},setUint16:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;g(this.data,this.offset,t,e);this.offset+=s},getUint16:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=U(this.data,this.offset,t);this.offset+=s;return e},setInt24:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;L(this.data,this.offset,t<0?t|16777216:t,e);this.offset+=_},getInt24:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=S(this.data,this.offset,t);this.offset+=_;return e&8388608?e^-16777216:e},setUint24:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;L(this.data,this.offset,t,e);this.offset+=_},getUint24:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=S(this.data,this.offset,t);this.offset+=_;return e},setInt32:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;C(this.data,this.offset,t<0?t|4294967296:t,e);this.offset+=E},getInt32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=D(this.data,this.offset,t);this.offset+=E;return e&2147483648?e^-4294967296:e},setUint32:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;C(this.data,this.offset,t,e);this.offset+=E},getUint32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=D(this.data,this.offset,t);this.offset+=E;return e},setFloat32:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;T(this.data,this.offset,t,e,23,4);this.offset+=E},getFloat32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var e=A(this.data,this.offset,t,23,4);this.offset+=E;return e},setString:function(t){this.setUint8(t.length);for(var e=0;e<t.length;++e){this.setUint8(t.charCodeAt(e))}},getString:function(){var t=this.getUint8();var e=this.offset+t;var r=[];while(this.offset<e){r.push(String.fromCharCode(this.getUint8()))}return r.join("")},getBytesToOffset:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.offset;return this.data.slice(0,t)},getBytesLeft:function(){return this.getBytes(this.bytesLeft)},getBytes:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.offset;this.offset=e+t;return this.data.slice(e,this.offset)},setBytes:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.offset;var r=this.data;r.splice.apply(r,[e,t.length].concat(n(t)));this.data=r;this.offset=e+t.length}};Object.defineProperties(P.prototype,{size:{get:function(){return this.data.length}},isEmpty:{get:function(){if(this.offset>this.data.length){throw new Error("current offset ".concat(this.offset," is outside the bounds of the buffer"))}return this.data.length-this.offset===0}},bytesLeft:{get:function(){return this.data.length-this.offset}},position:{get:function(){return this.offset}}});var M=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=0;for(var a in e){if(a in t&&e[a]){r|=t[a]}}return r};var y=function(t,e,r,a){var n=(1<<e)-1<<r-1;var i=a;var v=t;v&=~n;i<<=r-1;v|=i;return v};var m=80;var F=81;var p=82;var Y=83;var B=84;var G=85;var H=86;var V=87;var x=88;var w=89;var W=90;var K=91;var b=255;var X=Object.freeze({__proto__:null,DATA_REQUEST:m,DATA_RESPONSE:F,FRAGMENT_REQUEST:W,FRAGMENT_RESPONSE:K,IDENT_REQUEST:p,IDENT_RESPONSE:Y,INVALID:b,L2_CHECK_ADDRESS_REQUEST:H,L2_CHECK_ADDRESS_RESPONSE:V,L2_RM_ADDRESS_REQUEST:x,L2_RM_ADDRESS_RESPONSE:w,L2_SET_ADDRESS_REQUEST:B,L2_SET_ADDRESS_RESPONSE:G});var j=function(t){var e={};for(var r in t){var a=t[r];e[a]=r}return e};j(X);var z=1;var Q=2;var Z=3;var k=16;var q=17;var $=18;var J=19;var tt=20;var et=21;var rt=32;var at=33;var nt=34;var it=35;var vt=36;var st=37;var _t=38;var Et=39;var ot=40;var ft=41;var ut=49;var At=50;var Tt=51;var Rt=52;var Ot=53;var dt=54;var ct=55;var lt=56;var ht=57;var Nt=60;var Ut=61;var St=62;var Dt=63;var It=64;var gt=65;var Lt=66;var Ct=67;var Pt=68;var Mt=69;var yt=70;var mt=71;var Ft=72;var pt=73;var Yt=74;var Bt=75;var Gt=76;var Ht=77;var Vt=78;var xt=79;var wt=80;var Wt=81;var Kt=82;var bt=83;var Xt=84;var jt=85;var zt=86;var Qt=87;var Zt=88;var kt=89;var qt=96;var $t=97;var Jt=98;var te=99;var ee=100;var re=101;var ae=102;var ne=103;var ie=104;var ve=105;var se=112;var _e=113;var Ee=114;var oe=115;var fe=116;var ue=117;var Ae=118;var Te=119;var Re=120;var Oe=121;var de=122;var ce=123;var le=124;var he=125;var Ne=126;var Ue=144;var Se=145;var De=147;var Ie=148;var ge=152;var Le=156;var Ce=157;var Pe=158;var Me=159;var ye=160;var me=161;var Fe=162;var pe=176;var Ye=177;var Be=178;var Ge=179;var He=180;var Ve=181;var xe=182;var we=183;var We=185;var Ke=186;var be=224;var Xe=225;var je=226;var ze=227;var Qe=228;var Ze=229;var ke=230;var qe=231;var $e=232;var Je=Object.freeze({__proto__:null,ACCESS_LOCKED:k,ACC_PARAM_BAD:Ee,ACC_PARAM_EXT_BAD:oe,BAD_TEST_EEPROM:ie,BAD_TEST_FRAM:ve,BATTERY_FAULT:bt,BATTERY_OK:Kt,BIPOLAR_POWER_FAULT:He,BIPOLAR_POWER_OK:Ve,BLOCK_TARIFF_BAD:ue,CALC_PERIOD_BAD:fe,CALIBRATION_FAULT:jt,CALIBRATION_FLAG_RESET:ne,CALIBRATION_FLAG_SET:ae,CALIBRATION_OK:Xt,CALIBRATION_PARAM_BAD:Ae,CASE_CLOSE:J,CASE_KLEMA_CLOSE:ce,CASE_KLEMA_OPEN:de,CASE_MODULE_CLOSE:he,CASE_MODULE_OPEN:le,CASE_OPEN:$,CHANGE_ACCESS_KEY0:rt,CHANGE_ACCESS_KEY1:at,CHANGE_ACCESS_KEY2:nt,CHANGE_ACCESS_KEY3:it,CHANGE_COR_TIME:ft,CHANGE_PARAM_CANAL:We,CHANGE_PAR_LOCAL:vt,CHANGE_PAR_REMOTE:st,CHANGE_TARIFF_TABLE:At,CHANGE_TARIFF_TBL_2:ge,CLOCK_FAULT:Qt,CLOCK_OK:zt,CMD_CHANGE_TIME:_t,CMD_RELAY_2_OFF:$t,CMD_RELAY_2_ON:qt,CMD_RELAY_OFF:ot,CMD_RELAY_ON:Et,CROSS_ZERO_ENT0:Jt,CROSS_ZERO_ENT1:te,CROSS_ZERO_ENT2:ee,CROSS_ZERO_ENT3:re,CROSS_ZERO_EXPORT_ENT0:Pe,CROSS_ZERO_EXPORT_ENT1:Me,CROSS_ZERO_EXPORT_ENT2:ye,CROSS_ZERO_EXPORT_ENT3:me,CURRENT_UNEQUAL_FAULT:Be,CURRENT_UNEQUAL_OK:Ge,EM_MAGNETIC_OFF:Ye,EM_MAGNETIC_ON:pe,ENERGY_REGISTER_FAULT:z,ENERGY_REGISTER_OVERFLOW:ut,ERR_ACCESS:q,F_MAX_OK:Ft,F_MAX_OVER:pt,F_MIN_OK:Yt,F_MIN_OVER:Bt,I_MAX_OK:Gt,I_MAX_OVER:Ht,MAGNETIC_OFF:et,MAGNETIC_ON:tt,OP_PAR_FAULT:Z,POWER_A_OFF:Zt,POWER_A_ON:kt,POWER_B_OFF:Ut,POWER_B_ON:Nt,POWER_C_OFF:Dt,POWER_C_ON:St,POWER_GOOD_DIO:Ne,POWER_OVER_RELAY_OFF:Ce,POWER_SALDO_OK:wt,POWER_SALDO_OVER:Wt,P_MAX_A_MINUS_OK:qe,P_MAX_A_MINUS_OVER:$e,P_MAX_OK:Vt,P_MAX_OVER:xt,RELAY_HARD_BAD_OFF:Ue,RELAY_HARD_BAD_ON:De,RELAY_HARD_OFF:Ie,RELAY_HARD_ON:Se,RELAY_OFF:ct,RELAY_OFF_BAD_SALDO:Ke,RELAY_ON:dt,RESET_EM_FLAG:xe,RESET_MAGNET_FLAG:we,RESTART:lt,SALDO_EN_BAD:Re,SALDO_PARAM_BAD:_e,SET_DEMAND_EN_10MIN:ze,SET_DEMAND_EN_15MIN:Qe,SET_DEMAND_EN_1MIN:be,SET_DEMAND_EN_30MIN:Ze,SET_DEMAND_EN_3MIN:Xe,SET_DEMAND_EN_5MIN:je,SET_DEMAND_EN_60MIN:ke,SET_NEW_SALDO:se,SET_SALDO_PARAM:Le,SET_TARIFF_TABLE:Tt,SUMMER_TIME:Rt,TIME_CORRECT:Oe,TIME_CORRECT_NEW:Fe,T_MAX_OK:Pt,T_MAX_OVER:Mt,T_MIN_OK:yt,T_MIN_OVER:mt,VENDOR_PAR_FAULT:Q,V_MAX_OK:It,V_MAX_OVER:gt,V_MIN_OK:Lt,V_MIN_OVER:Ct,WD_RESTART:ht,WINTER_SUMMER_BAD:Te,WINTER_TIME:Ot});j(Je);var tr=11;var er=74;var rr=7;var ar=2+rr;var nr={SET_ALL_SEGMENT_DISPLAY:1,SOFTWARE_VERSION:2,TOTAL_ACTIVE_ENERGY:4,ACTIVE_ENERGY_T1:8,ACTIVE_ENERGY_T2:16,ACTIVE_ENERGY_T3:32,ACTIVE_ENERGY_T4:64,ACTIVE_POWER_PER_PHASE:128,ACTIVE_POWER_IN_NEUTRAL:256,CURRENT_IN_PHASE:512,CURRENT_IN_NEUTRAL:1024,VOLTAGE:2048,HOUR_MINUTE_SECOND:4096,DATE_MONTH_YEAR:8192,TOTAL_EXPORTED_ACTIVE_ENERGY:16384,EXPORTED_ACTIVE_ENERGY_T1:32768,EXPORTED_ACTIVE_ENERGY_T2:65536,EXPORTED_ACTIVE_ENERGY_T3:131072,EXPORTED_ACTIVE_ENERGY_T4:262144,POWER_FACTOR_PHASE_A:524288,POWER_FACTOR_PHASE_B:1048576,BATTERY_VOLTAGE:2097152,POWER_THRESHOLD_T1:4194304,POWER_THRESHOLD_T2:8388608,POWER_THRESHOLD_T3:16777216,POWER_THRESHOLD_T4:33554432,CURRENT_BALANCE:536870912};var ir={...nr,AUTO_SCREEN_SCROLLING:2147483648};var vr={...nr,MAGNET_INDUCTION:134217728,OPTOPORT_SPEED:1073741824,SORT_DISPLAY_SCREENS:2147483648};var sr={RELAY_ON_Y:1,RELAY_ON_CENTER:2,RELAY_ON_PB:4,RELAY_ON_TARIFF_1:8,RELAY_ON_TARIFF_2:16,RELAY_ON_TARIFF_3:32,RELAY_ON_TARIFF_4:64,RELAY_ON_V_GOOD:128};var _r={RELAY_OFF_Y:1,RELAY_OFF_CENTER:2,RELAY_OFF_TARIFF_1:4,RELAY_OFF_TARIFF_2:8,RELAY_OFF_TARIFF_3:16,RELAY_OFF_TARIFF_4:32,RELAY_OFF_I_LIMIT:64,RELAY_OFF_V_BAD:128};var Er={RELAY_OFF_LIM_TARIFF_1:2,RELAY_OFF_LIM_TARIFF_2:4,RELAY_OFF_LIM_TARIFF_3:8,RELAY_OFF_LIM_TARIFF_4:16,RELAY_OFF_PF_MIN:32};var or={RELAY_ON_TIMEOUT:1,RELAY_ON_SALDO:2,RELAY_OFF_SALDO:4,RELAY_OFF_SALDO_SOFT:8,RELAY_OFF_MAGNET:16,RELAY_ON_MAGNET_TIMEOUT:32,RELAY_ON_MAGNET_AUTO:64};var fr={RELAY_OFF_UNEQUAL_CURRENT:1,RELAY_ON_UNEQUAL_CURRENT:2,RELAY_OFF_BIPOLAR_POWER:4,RELAY_ON_BIPOLAR_POWER:8};var ur={BLOCK_KEY_OPTOPORT:2,MAGNET_SCREEN_CONST:32};var Ar={RELAY_OFF_LIMIT_P_MINUS_T1:8,RELAY_OFF_LIMIT_P_MINUS_T2:16,RELAY_OFF_LIMIT_P_MINUS_T3:32,RELAY_OFF_LIMIT_P_MINUS_T4:64};var Tr=function(t){var e=0;e=y(e,2,1,t.tariff);e=y(e,1,3,+!t.isFirstHalfHour);e=y(e,5,4,t.hour);return e};var Rr=function(t,e){t.setUint8(e.isSummerTime?1:0);t.setUint8(e.seconds);t.setUint8(e.minutes);t.setUint8(e.hours);t.setUint8(e.day||0);t.setUint8(e.date);t.setUint8(e.month);t.setUint8(e.year)};var Or=function(t,e){t.setUint32(e.id);t.setUint8(e.tariffSet);t.setUint8(e.activateYear);t.setUint8(e.activateMonth);t.setUint8(e.activateDay);t.setUint8(e.specialProfilesArraySize);t.setUint8(e.seasonProfilesArraySize);t.setUint8(e.dayProfilesArraySize)};var dr=function(t,e){t.setUint8(e.monthTransitionSummer);t.setUint8(e.dateTransitionSummer);t.setUint8(e.hoursTransitionSummer);t.setUint8(e.hoursCorrectSummer);t.setUint8(e.monthTransitionWinter);t.setUint8(e.dateTransitionWinter);t.setUint8(e.hoursTransitionWinter);t.setUint8(e.hoursCorrectWinter);t.setUint8(+e.isCorrectionNeeded)};var cr=function(t,e){t.setUint8(Tr(e))};var lr=function(t,e){t.setUint8(e.month);t.setUint8(e.date);e.dayIndexes.forEach(function(e){return t.setUint8(e)})};var hr=function(t,e){t.setUint8(e.month);t.setUint8(e.date);t.setUint8(e.dayIndex);t.setUint8(+!e.isPeriodic)};var Nr=function(t,e){var r=e.timeCorrectPeriod|(e.timeCorrectPassHalfhour?128:0);t.setUint32(e.vpThreshold);t.setUint32(e.vThreshold);t.setUint32(e.ipThreshold);t.setUint32(e.pmaxThreshold0);t.setUint32(e.pmaxThreshold1);t.setUint32(e.pmaxThreshold2);t.setUint32(e.pmaxThreshold3);t.setUint8(e.speedOptoPort);t.setUint8(e.tint);t.setUint8(e.calcPeriodDate);t.setUint8(e.timeoutDisplay);t.setUint8(e.timeoutScreen);t.setUint32(M(ir,e.displaySet));t.setUint8(M(or,e.relaySet4));t.setUint8(M(Er,e.relaySet3));t.setUint8(M(_r,e.relaySet2));t.setUint8(M(sr,e.relaySet1));t.setUint8(e.displayType);t.setUint8(e.ten);t.setUint16(e.timeoutRefresh);t.setUint8(e.deltaCorMin);t.setUint8(e.timeoutMagnetOff);t.setUint8(e.timeoutMagnetOn);t.setUint8(M(ur,e.define1));t.setUint8(e.timeoutRelayOn);t.setUint8(e.timeoutRelayKey);t.setUint8(e.timeoutRelayAuto);t.setUint8(e.timeoutBadVAVB);t.setUint8(e.freqMax);t.setUint8(e.freqMin);t.setUint16(e.phMin);t.setUint8(e.year);t.setUint8(e.month);t.setUint8(e.date);t.setUint8(e.energyDecimalPoint);t.setUint8(e.typeMeter);t.setUint8(e.timeoutIMax);t.setUint8(e.timeoutPMax);t.setUint8(e.timeoutCos);t.setUint8(e.pMaxDef);t.setUint32(M(vr,e.displaySetExt));t.setUint8(e.timeoutUneqCurrent);t.setUint8(e.timeoutBipolarPower);t.setUint8(M(fr,e.relaySet5));t.setUint8(r)};var Ur=function(t,e){t.setUint8(e.year);t.setUint8(e.month);t.setUint8(e.date)};var Sr=function(t,e){e.coefficients.forEach(function(e){return t.setUint32(e)});t.setUint8(e.decimalPointTariff);t.setInt32(e.indicationThreshold);t.setInt32(e.relayThreshold);t.setUint8(e.mode);t.setUint8(e.saldoOffTimeBegin);t.setUint8(e.saldoOffTimeEnd);t.setUint8(e.decimalPointIndication);t.setUint32(e.powerThreshold);t.setInt32(e.creditThreshold)};var Dr=function(t,e){var r=e.date.year<<1|e.date.month>>3&1;var a=e.date.month<<5&224|e.date.date&31;t.setUint8(r);t.setUint8(a);t.setUint8(e.energyType);t.setUint16(e.firstIndex);t.setUint8(e.count);t.setUint8(e.period)};var Ir=function(t,e){t.setUint8(e.channelParam1);t.setUint8(e.counterInterval);t.setUint8(e.channelParam2);t.setUint8(0)};var gr=function(t,e){var r=e.pmaxMinusThreshold0,a=e.pmaxMinusThreshold1,n=e.pmaxMinusThreshold2,i=e.pmaxMinusThreshold3,v=e.relaySet;t.setUint32(r);t.setUint32(a);t.setUint32(n);t.setUint32(i);t.setUint8(M(Ar,v))};var Lr=function(t){return btoa(t.map(function(t){return String.fromCharCode(t)}).join(""))};var Cr=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return[t,e.length].concat(n(e))};var Pr=0;var Mr=3;var yr=1;var mr=3;var Fr=4;var pr=5;var Yr=7;var Br=8;var Gr=9;var Hr=13;var Vr=15;var xr=16;var wr=17;var Wr=18;var Kr=19;var br=20;var Xr=21;var jr=22;var zr=23;var Qr=24;var Zr=25;var kr=28;var qr=30;var $r=31;var Jr=40;var ta=41;var ea=42;var ra=44;var aa=45;var na=46;var ia=47;var va=49;var sa=50;var _a=51;var Ea=52;var oa=53;var fa=54;var ua=57;var Aa=58;var Ta=59;var Ra=60;var Oa=61;var da=62;var ca=65;var la=70;var ha=74;var Na=75;var Ua=79;var Sa=80;var Da=82;var Ia=83;var ga=88;var La=89;var Ca=91;var Pa=92;var Ma=93;var ya=94;var ma=100;var Fa=109;var pa=111;var Ya=112;var Ba=113;var Ga=114;var Ha=116;var Va=117;var xa=118;var wa=122;var Wa=Object.freeze({__proto__:null,activateRatePlan:Kr,getBuildVersion:Ya,getCorrectTime:da,getCriticalEvent:ca,getCurrentStatusMeter:ua,getCurrentValues:Hr,getDateTime:Yr,getDayDemand:jr,getDayDemandExport:Ua,getDayMaxDemand:va,getDayMaxDemandExport:ga,getDayMaxDemandPrevious:ha,getDayProfile:Ta,getDemand:xa,getDemandParameters:Va,getDeviceId:pr,getDeviceType:Fr,getDisplayParam:ya,getEnergy:Vr,getEnergyDayPrevious:mr,getEnergyExport:Ca,getEnergyExportDayPrevious:Sa,getEventStatus:yr,getEvents:_a,getEventsCounters:Ea,getExtendedCurrentValues:Aa,getExtendedCurrentValues2:aa,getHalfHourDemand:Xr,getHalfHourDemandExport:Ia,getHalfHourDemandPrevious:Na,getHalfHourEnergies:pa,getMagneticFieldThreshold:Fa,getMeterInfo:wa,getMonthDemand:zr,getMonthDemandExport:Da,getMonthMaxDemand:sa,getMonthMaxDemandExport:La,getOperatorParameters:qr,getOperatorParametersExtended3:Ba,getRatePlanInfo:ra,getSaldo:ta,getSaldoParameters:na,getSeasonProfile:Ra,getSpecialDay:Oa,getVersion:Jr,prepareRatePlan:br,resetPowerMaxDay:oa,resetPowerMaxMonth:fa,runTariffPlan:la,setAccessKey:Gr,setCorrectDateTime:Pa,setCorrectTime:kr,setDateTime:Br,setDayProfile:xr,setDemandParameters:Ha,setDisplayParam:Ma,setOperatorParameters:$r,setOperatorParametersExtended3:Ga,setSaldo:ea,setSaldoParameters:ia,setSeasonProfile:wr,setSpecialDay:Wr,setSpecialOperation:ma,turnRelayOff:Zr,turnRelayOn:Qr});j(Wa);var Ka=Kr;var ba=1+tr;var Xa=function(t){var e=new P(ba,false);e.setUint8(t.tariffTable);Or(e,t.tariffPlan);return Cr(Ka,e.data)};var ja=Ya;var za=function(){return Cr(ja)};var Qa=da;var Za=function(){return Cr(Qa)};var ka=0;var qa=1;var $a=2;var Ja=3;var tn=4;var en=5;var rn=6;var an=7;var nn=8;var vn=9;var sn=10;var _n=11;var En=12;var on=13;var fn=14;var un=Object.freeze({__proto__:null,CASE_MODULE_OPEN:sn,CASE_OPEN:ka,CASE_TERMINAL_OPEN:vn,DEVICE_FAILURE:nn,ERROR_ACCESS:en,MAGNETIC_ON:qa,PARAMETERS_UPDATE_LOCAL:Ja,PARAMETERS_UPDATE_REMOTE:$a,PROTECTION_RESET_EM:on,PROTECTION_RESET_MAGNETIC:fn,RESTART:tn,TARIFF_TABLE_GET:En,TARIFF_TABLE_SET:_n,TIME_CORRECT:an,TIME_SET:rn});j(un);var An=ca;var Tn=function(t){return Cr(An,[t.event,t.index])};var Rn=ua;var On=function(){return Cr(Rn)};var dn=Hr;var cn=function(){return Cr(dn)};var ln=Yr;var hn=function(){return Cr(ln)};var Nn=3;var Un=4;var Sn=jr;var Dn=function(t){var e=new P(t?.energyType?Un:Nn);Ur(e,t?.date);if(t?.energyType){e.setUint8(t.energyType)}return Cr(Sn,e.data)};var In=3;var gn=4;var Ln=Ua;var Cn=function(t){var e=new P(t?.energyType?gn:In,false);Ur(e,t?.date);if(t?.energyType){e.setUint8(t.energyType)}return Cr(Ln,e.data)};var Pn=va;var Mn=3;var yn=function(t){var e=new P(Mn,false);Ur(e,t.date);return Cr(Pn,e.data)};var mn=ga;var Fn=3;var pn=function(t){var e=new P(Fn,false);Ur(e,t.date);return Cr(mn,e.data)};var Yn=ha;var Bn=function(){return Cr(Yn)};var Gn=Ta;var Hn=3;var Vn=function(t){var e=new P(Hn,false);e.setUint8(t.tariffTable);e.setUint8(t.index);e.setUint8(t.isActive?0:1);return Cr(Gn,e.data)};var xn=xa;var wn=7;var Wn=function(t){var e=new P(wn,false);Dr(e,t);return Cr(xn,e.data)};var Kn=Va;var bn=function(){return Cr(Kn)};var Xn=pr;var jn=function(){return Cr(Xn)};var zn=Fr;var Qn=function(){return Cr(zn)};var Zn=0;var kn=128;var qn=129;var $n=130;var Jn=131;var ti=132;var ei=133;var ri=134;var ai=135;var ni=136;var ii=137;var vi=144;var si=145;var _i=146;var Ei=147;var oi=149;var fi=151;var ui=152;var Ai=153;var Ti=154;var Ri=155;var Oi=156;var di=159;var ci=160;var li=240;var hi=Object.freeze({__proto__:null,ACCESS_DENIED:Ei,BAD_ARRAY_INDEX:ri,BAD_BLOCK_NUMBER:Oi,BAD_DATA_LENGTH:ei,BAD_MESSAGE:ti,BAD_RATE_PLAN_ID:ni,BAD_RATE_PLAN_SIZE:ii,BAD_RESPONSE_LENGTH:vi,BAD_SALDO_WRITE:oi,BLOCKED_METER:fi,CALIBRATION_DISABLED:_i,DECRYPTION_FAILURE:$n,INTERNAL:li,INVALID_CORRECTION_INTERVAL:Ti,NOT_ALIGNED_DATA:qn,NOT_PREPARED_RATE_PLAN:ai,NO_DATA_FOR_DATE:si,OK:Zn,OUT_OFF_RANGE:di,SET_METER_TYPE_FAILURE:ci,TIME_CORRECTION_FAILURE:Ai,TIME_CORRECTION_OUT_HALF_HOUR_DISABLED:Ri,UNENCRYPTED_COMMAND_DISABLED:ui,UNKNOWN_COMMAND:kn,UNKNOWN_PROTOCOL:Jn});j(hi);var Ni=1;var Ui=2;var Si=3;var Di=4;var Ii=5;var gi=6;var Li=7;var Ci=8;var Pi=9;var Mi=10;var yi=11;var mi=12;var Fi=13;var pi=14;var Yi=15;var Bi=16;var Gi=17;var Hi=18;var Vi=19;var xi=20;var wi=21;var Wi=22;var Ki=23;var bi=24;var Xi=25;var ji=26;var zi=28;var Qi=30;var Zi=31;var ki=Object.freeze({__proto__:null,ACTIVE_ENERGY_T1:Di,ACTIVE_ENERGY_T2:Ii,ACTIVE_ENERGY_T3:gi,ACTIVE_ENERGY_T4:Li,ACTIVE_POWER_IN_NEUTRAL:Pi,ACTIVE_POWER_PER_PHASE:Ci,BATTERY_VOLTAGE:Wi,CURRENT_BALANCE:Qi,CURRENT_IN_NEUTRAL:yi,CURRENT_IN_PHASE:Mi,DATE_MONTH_YEAR:pi,EXPORTED_ACTIVE_ENERGY_T1:Bi,EXPORTED_ACTIVE_ENERGY_T2:Gi,EXPORTED_ACTIVE_ENERGY_T3:Hi,EXPORTED_ACTIVE_ENERGY_T4:Vi,HOUR_MINUTE_SECOND:Fi,MAGNET_INDUCTION:zi,OPTOPORT_SPEED:Zi,POWER_FACTOR_PHASE_A:xi,POWER_FACTOR_PHASE_B:wi,POWER_THRESHOLD_T1:Ki,POWER_THRESHOLD_T2:bi,POWER_THRESHOLD_T3:Xi,POWER_THRESHOLD_T4:ji,SET_ALL_SEGMENT_DISPLAY:Ni,SOFTWARE_VERSION:Ui,TOTAL_ACTIVE_ENERGY:Si,TOTAL_EXPORTED_ACTIVE_ENERGY:Yi,VOLTAGE:mi});j(ki);var qi=120;var $i=121;var Ji=254;var tv=Object.freeze({__proto__:null,activateRatePlan:Kr,errorResponse:Ji,getBuildVersion:Ya,getCorrectTime:da,getCriticalEvent:ca,getCurrentStatusMeter:ua,getCurrentValues:Hr,getDateTime:Yr,getDayDemand:jr,getDayDemandExport:Ua,getDayEnergies:qi,getDayMaxDemand:va,getDayMaxDemandExport:ga,getDayMaxDemandPrevious:ha,getDayMaxPower:$i,getDayProfile:Ta,getDemand:xa,getDemandParameters:Va,getDeviceId:pr,getDeviceType:Fr,getDisplayParam:ya,getEnergy:Vr,getEnergyDayPrevious:mr,getEnergyExport:Ca,getEnergyExportDayPrevious:Sa,getEventStatus:yr,getEvents:_a,getEventsCounters:Ea,getExtendedCurrentValues:Aa,getExtendedCurrentValues2:aa,getHalfHourDemand:Xr,getHalfHourDemandExport:Ia,getHalfHourDemandPrevious:Na,getHalfHourEnergies:pa,getMagneticFieldThreshold:Fa,getMeterInfo:wa,getMonthDemand:zr,getMonthDemandExport:Da,getMonthMaxDemand:sa,getMonthMaxDemandExport:La,getOperatorParameters:qr,getOperatorParametersExtended3:Ba,getRatePlanInfo:ra,getSaldo:ta,getSaldoParameters:na,getSeasonProfile:Ra,getSpecialDay:Oa,getVersion:Jr,prepareRatePlan:br,resetPowerMaxDay:oa,resetPowerMaxMonth:fa,runTariffPlan:la,setAccessKey:Gr,setCorrectDateTime:Pa,setCorrectTime:kr,setDateTime:Br,setDayProfile:xr,setDemandParameters:Ha,setDisplayParam:Ma,setOperatorParameters:$r,setOperatorParametersExtended3:Ga,setSaldo:ea,setSaldoParameters:ia,setSeasonProfile:wr,setSpecialDay:Wr,setSpecialOperation:ma,turnRelayOff:Zr,turnRelayOn:Qr});j(tv);var ev=ya;var rv=1;var av=function(t){var e=new P(rv,false);e.setUint8(t.displayMode);return Cr(ev,e.data)};var nv=0;var iv=1;var vv=Vr;var sv=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var e=new P(t?.energyType?iv:nv,false);if(t?.energyType){e.setUint8(t.energyType)}return Cr(vv,e.data)};var _v=mr;var Ev=function(t){if(t.energyType){return Cr(_v,[t.energyType])}return Cr(_v)};var ov=0;var fv=1;var uv=Ca;var Av=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var e=new P(t?.energyType?fv:ov,false);if(t?.energyType){e.setUint8(t.energyType)}return Cr(uv,e.data)};var Tv=Sa;var Rv=function(t){if(t.energyType){return Cr(Tv,[t.energyType])}return Cr(Tv)};var Ov=_a;var dv=4;var cv=function(t){var e=new P(dv,false);Ur(e,t.date);e.setUint8(t.offset);return Cr(Ov,e.data)};var lv=Ea;var hv=function(){return Cr(lv)};var Nv=yr;var Uv=function(){return Cr(Nv)};var Sv=Aa;var Dv=function(){return Cr(Sv)};var Iv=aa;var gv=function(){return Cr(Iv)};var Lv=Xr;var Cv=3;var Pv=function(t){var e=new P(Cv,false);Ur(e,t.date);return Cr(Lv,e.data)};var Mv=Ia;var yv=3;var mv=function(t){var e=new P(yv,false);Ur(e,t.date);return Cr(Mv,e.data)};var Fv=Na;var pv=function(){return Cr(Fv)};var Yv={"A+":1,"A+R+":2,"A+R-":4,"A-":8,"A-R+":16,"A-R-":32};var Bv=function(t){var e={};Object.keys(t).forEach(function(r){e[r]=!!t[r]});return M(Yv,e)};var Gv=function(t,e){var r=e.year,a=e.month,n=e.date;var i=r<<1|a>>3&1;var v=a<<5&224|n&31;t.setUint8(i);t.setUint8(v)};var Hv=function(t,e){t.setUint8(Bv(e))};var Vv=pa;var xv=5;var wv=function(t){var e=new P(xv,false);Gv(e,t.date);Hv(e,t.energies);e.setUint8(t.firstHalfhour);e.setUint8(t.halfhoursNumber);return Cr(Vv,e.data)};var Wv=Fa;var Kv=function(){return Cr(Wv)};var bv=wa;var Xv=function(){return Cr(bv)};var jv=zr;var zv=2;var Qv=function(t){var e=new P(zv,false);e.setUint8(t.year);e.setUint8(t.month);return Cr(jv,e.data)};var Zv=Da;var kv=2;var qv=function(t){var e=new P(kv,false);e.setUint8(t.year);e.setUint8(t.month);return Cr(Zv,e.data)};var $v=sa;var Jv=function(t){var e=t.year,r=t.month;return Cr($v,[e,r])};var ts=La;var es=function(t){var e=t.year,r=t.month;return Cr(ts,[e,r])};var rs=qr;var as=function(){return Cr(rs)};var ns=Ba;var is=function(){return Cr(ns)};var vs=ra;var ss=function(t){return Cr(vs,[t.tariffTable])};var _s=ta;var Es=function(){return Cr(_s)};var os=na;var fs=function(){return Cr(os)};var us=Ra;var As=3;var Ts=function(t){var e=new P(As,false);e.setUint8(t.tariffTable);e.setUint8(t.index);e.setUint8(t.isActive?0:1);return Cr(us,e.data)};var Rs=Oa;var Os=3;var ds=function(t){var e=new P(Os,false);e.setUint8(t.tariffTable);e.setUint8(t.index);e.setUint8(t.isActive?0:1);return Cr(Rs,e.data)};var cs=Jr;var ls=function(){return Cr(cs)};var hs=br;var Ns=5;var Us=function(t){var e=new P(Ns,false);e.setUint8(t.tariffTable);e.setUint32(t.id);return Cr(hs,e.data)};var Ss=oa;var Ds=function(){return Cr(Ss)};var Is=fa;var gs=function(){return Cr(Is)};var Ls=la;var Cs=function(t){return Cr(Ls,[t.tariffTable])};var Ps=16;var Ms=Gr;var ys=1+Ps;var ms=function(t){var e=new P(ys,false);e.setUint8(t.accessLevel);e.setBytes(t.key);return Cr(Ms,e.data)};var Fs=Pa;var ps=2;var Ys=function(t){var e=new P(ps,false);e.setInt16(t.seconds);return Cr(Fs,e.data)};var Bs=kr;var Gs=9;var Hs=function(t){var e=new P(Gs,false);dr(e,t);return Cr(Bs,e.data)};var Vs=Br;var xs=8;var ws=function(t){var e=new P(xs,false);Rr(e,t);return Cr(Vs,e.data)};var Ws=8;var Ks=255;var bs=xr;var Xs=function(t){var e=t.periods.length<Ws;var r=2+t.periods.length+ +e;var a=new P(r,false);a.setUint8(t.tariffTable);a.setUint8(t.index);t.periods.forEach(function(t){cr(a,t)});if(e){a.setUint8(Ks)}return Cr(bs,a.data)};var js=Ha;var zs=4;var Qs=function(t){var e=new P(zs,false);Ir(e,t);return Cr(js,e.data)};var Zs=Ma;var ks=function(t){return Cr(Zs,[t.displayMode].concat(n(t.order)))};var qs=$r;var $s=er;var Js=function(t){var e=new P($s,false);Nr(e,t);return Cr(qs,e.data)};var t_=Ga;var e_=17;var r_=function(t){var e=new P(e_,false);gr(e,t);return Cr(t_,e.data)};var a_=ea;var n_=12;var i_=function(t){var e=new P(n_,false);e.setUint8(t.date.month);e.setUint8(t.date.date);e.setUint8(t.date.hours);e.setUint8(t.date.minutes);e.setInt32(t.saldoNew);e.setInt32(t.saldoOld);return Cr(a_,e.data)};var v_=ia;var s_=37;var __=function(t){var e=new P(s_,false);Sr(e,t);return Cr(v_,e.data)};var E_=wr;var o_=ar;var f_=function(t){var e=new P(o_,false);e.setUint8(t.tariffTable);e.setUint8(t.index);lr(e,t);return Cr(E_,e.data)};var u_=Wr;var A_=6;var T_=function(t){var e=new P(A_,false);e.setUint8(t.tariffTable);e.setUint8(t.index);hr(e,t);return Cr(u_,e.data)};var R_=ma;var O_=2;var d_=function(t){var e=new P(O_,false);var r=0;if(t.readScreensInfo){r|=128}if(t.resetElectroMagneticIndication){r|=1}if(t.resetMagneticIndication){r|=2}e.setUint8(t.type);e.setUint8(r);return Cr(R_,e.data)};var c_=Zr;var l_=function(){return Cr(c_)};var h_=Qr;var N_=function(){return Cr(h_)};var U_={encrypt:function(){},decrypt:function(){}};var S_=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:85;var r=e;t.forEach(function(t){r^=t});return r};var D_=16;var I_=[0];var g_=function(t){return function(e,r){var a;var i=r.messageId,v=i===void 0?1:i,s=r.accessLevel,_=s===void 0?Mr:s,E=r.aesKey;var o=e.map(function(e){if("id"in e){return t[e.id](e.parameters||{})}if("command"in e){return e.command.bytes}throw new Error("wrong command format")});var f=_|16;var u=[v,f];var A=(a=[]).concat.apply(a,[f].concat(n(o),[I_]));if(_!==Pr){var T=(A.length+1)%D_;if(T){A=A.concat(new Array(D_-T).fill(0))}}A=A.concat(S_(A));if(E&&_!==Pr){A=n(U_.encrypt(E,A))}return u.concat(A)}};var L_={};var C_=g_(L_);L_[Ka]=Xa;L_[ja]=za;L_[Qa]=Za;L_[An]=Tn;L_[Rn]=On;L_[dn]=cn;L_[ln]=hn;L_[Sn]=Dn;L_[Ln]=Cn;L_[Pn]=yn;L_[mn]=pn;L_[Yn]=Bn;L_[Gn]=Vn;L_[xn]=Wn;L_[Kn]=bn;L_[Xn]=jn;L_[zn]=Qn;L_[ev]=av;L_[vv]=sv;L_[_v]=Ev;L_[uv]=Av;L_[Tv]=Rv;L_[Ov]=cv;L_[lv]=hv;L_[Nv]=Uv;L_[Sv]=Dv;L_[Iv]=gv;L_[Lv]=Pv;L_[Mv]=mv;L_[Fv]=pv;L_[Vv]=wv;L_[Wv]=Kv;L_[bv]=Xv;L_[jv]=Qv;L_[Zv]=qv;L_[$v]=Jv;L_[ts]=es;L_[rs]=as;L_[ns]=is;L_[vs]=ss;L_[_s]=Es;L_[os]=fs;L_[us]=Ts;L_[Rs]=ds;L_[cs]=ls;L_[hs]=Us;L_[Ss]=Ds;L_[Is]=gs;L_[Ls]=Cs;L_[Ms]=ms;L_[Fs]=Ys;L_[Bs]=Hs;L_[Vs]=ws;L_[bs]=Xs;L_[js]=Qs;L_[Zs]=ks;L_[qs]=Js;L_[t_]=r_;L_[a_]=i_;L_[v_]=__;L_[E_]=f_;L_[u_]=T_;L_[R_]=d_;L_[c_]=l_;L_[h_]=N_;var P_=145;var M_=30;var y_=function(t){var e=[M_,t.length+2,0,P_].concat(n(t));return[].concat(n(e),[S_(e)])};toBytes=C_;getBase64FromBytes=Lr;setDataSegment=y_})();
//#endregion


/*
  Incoming arguments:
    * msg - JSON message payload downlink message json
    * msgType - type of message, for ex. 'ATTRIBUTES_UPDATED', 'POST_TELEMETRY_REQUEST', etc.
    * metadata - list of key-value pairs with additional data about the message
    * integrationMetadata - list of key-value pairs with additional data defined in Integration executing this converter

  Output must be an object with the following fields:
    * contentType - BINARY
    * data - payload in base64
*/

var bytes = toBytes(msg.commands);

// send nothing if not fit in a single data segment
if ( bytes.length > MAX_DATA_SEGMENT_SIZE ) {
    bytes = [];
} else {
    bytes = setDataSegment(bytes);
}

var result = {
    contentType: 'BINARY',
    data: getBase64FromBytes(bytes)
};

return result;
