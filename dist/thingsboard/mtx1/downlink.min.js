// IMPORTANT!!!
// This example only for default downlink data converter.
// Data converters for other integrations use different input and result.
// Find example of uplink data converter for your integration and edit usage of payload and result
// Integrations list: https://thingsboard.io/docs/user-guide/integrations/

// encoded message should be less than this size
// to be able to send to a device
var MAX_DATA_SEGMENT_SIZE = 50;


//#region [autogenerated jooby-codec bundle from index.js]
var toBytes,setDataSegment,getBase64FromBytes;(function(){"use strict";function t(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,a=Array(r);e<r;e++)a[e]=t[e];return a}function r(r){if(Array.isArray(r))return t(r)}function e(t,r,e){return(r=E(r))in t?Object.defineProperty(t,r,{value:e,enumerable:true,configurable:true,writable:true}):t[r]=e,t}function a(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t){return r(t)||a(t)||_(t)||n()}function v(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var a=e.call(t,r);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function E(t){var r=v(t,"string");return"symbol"==typeof r?r:r+""}function _(r,e){if(r){if("string"==typeof r)return t(r,e);var a={}.toString.call(r).slice(8,-1);return"Object"===a&&r.constructor&&(a=r.constructor.name),"Map"===a||"Set"===a?Array.from(r):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(r,e):void 0}}var s=1;var o=2;var f=3;var u=4;var T=Math.log,A=Math.pow,R=Math.LN2;var O=function(t,r,e,a,n){var i,v,E=n*8-a-1,_=(1<<E)-1,s=_>>1,o=-7,f=e?n-1:0,u=e?-1:1,T=t[r+f];f+=u;i=T&(1<<-o)-1;T>>=-o;o+=E;for(;o>0;i=i*256+t[r+f],f+=u,o-=8);v=i&(1<<-o)-1;i>>=-o;o+=a;for(;o>0;v=v*256+t[r+f],f+=u,o-=8);if(i===0){i=1-s}else if(i===_){return v?NaN:T?-Infinity:Infinity}else{v=v+A(2,a);i=i-s}return(T?-1:1)*v*A(2,i-a)};var d=function(t,r,e,a,n,i){var v,E,_,s=i*8-n-1,o=(1<<s)-1,f=o>>1,u=n===23?A(2,-24)-A(2,-77):0,O=a?0:i-1,d=a?1:-1,c=e<0||e===0&&1/e<0?1:0;e<0&&(e=-e);if(e!==e||e===Infinity){E=e!==e?1:0;v=o}else{v=T(e)/R|0;if(e*(_=A(2,-v))<1){v--;_*=2}if(v+f>=1){e+=u/_}else{e+=u*A(2,1-f)}if(e*_>=2){v++;_/=2}if(v+f>=o){E=0;v=o}else if(v+f>=1){E=(e*_-1)*A(2,n);v=v+f}else{E=e*A(2,f-1)*A(2,n);v=0}}for(;n>=8;t[r+O]=E&255,O+=d,E/=256,n-=8);v=v<<n|E;s+=n;for(;s>0;t[r+O]=v&255,O+=d,v/=256,s-=8);t[r+O-d]|=c*128};var c=[1,0];var l=[2,1,0];var N=[3,2,1,0];var U=[0,1];var h=[0,1,2];var S=[0,1,2,3];var D=function(t,r){return t[r]};var L=function(t,r,e){var a=e?U:c;var n=t[r+a[0]];var i=t[r+a[1]]<<8;return n|i};var I=function(t,r,e){var a=e?h:l;var n=t[r+a[0]];var i=t[r+a[1]]<<8;var v=t[r+a[2]]<<16;return n|i|v};var g=function(t,r,e){var a=e?S:N;var n=t[r+a[3]]*16777216;var i=t[r+a[2]]*65536;var v=t[r+a[1]]*256;var E=t[r+a[0]];return n+i+v+E};var C=function(t,r,e){t[r]=e&255};var P=function(t,r,e,a){var n=a?U:c;t[r+n[0]]=e&255;t[r+n[1]]=e>>>8&255};var M=function(t,r,e,a){var n=a?h:l;t[r+n[0]]=e&255;t[r+n[1]]=e>>>8&255;t[r+n[2]]=e>>>16&255};var y=function(t,r,e,a){var n=a?S:N;t[r+n[0]]=e&255;t[r+n[1]]=e>>>8&255;t[r+n[2]]=e>>>16&255;t[r+n[3]]=e>>>24&255};function m(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(typeof t==="number"){var e=new Array(t).fill(0);this.data=e}else{this.data=t}this.offset=0;this.isLittleEndian=r}m.prototype={toUint8Array:function(){return this.data},seek:function(t){if(t<0||t>=this.data.length){throw new Error("Invalid position.")}this.offset=t},setInt8:function(t){C(this.data,this.offset,t<0?t|256:t);this.offset+=s},getInt8:function(){var t=D(this.data,this.offset);this.offset+=s;return t&128?t^-256:t},setUint8:function(t){C(this.data,this.offset,t);this.offset+=s},getUint8:function(){var t=D(this.data,this.offset);this.offset+=s;return t},setInt16:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;P(this.data,this.offset,t<0?t|65536:t,r);this.offset+=o},getInt16:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=L(this.data,this.offset,t);this.offset+=o;return r&32768?r^-65536:r},setUint16:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;P(this.data,this.offset,t,r);this.offset+=o},getUint16:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=L(this.data,this.offset,t);this.offset+=o;return r},setInt24:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;M(this.data,this.offset,t<0?t|16777216:t,r);this.offset+=f},getInt24:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=I(this.data,this.offset,t);this.offset+=f;return r&8388608?r^-16777216:r},setUint24:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;M(this.data,this.offset,t,r);this.offset+=f},getUint24:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=I(this.data,this.offset,t);this.offset+=f;return r},setInt32:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;y(this.data,this.offset,t<0?t|4294967296:t,r);this.offset+=u},getInt32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=g(this.data,this.offset,t);this.offset+=u;return r&2147483648?r^-4294967296:r},setUint32:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;y(this.data,this.offset,t,r);this.offset+=u},getUint32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=g(this.data,this.offset,t);this.offset+=u;return r},setFloat32:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.isLittleEndian;d(this.data,this.offset,t,r,23,4);this.offset+=u},getFloat32:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.isLittleEndian;var r=O(this.data,this.offset,t,23,4);this.offset+=u;return r},setString:function(t){this.setUint8(t.length);for(var r=0;r<t.length;++r){this.setUint8(t.charCodeAt(r))}},getString:function(){var t=this.getUint8();var r=this.offset+t;var e=[];while(this.offset<r){e.push(String.fromCharCode(this.getUint8()))}return e.join("")},getBytesToOffset:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.offset;return this.data.slice(0,t)},getBytesLeft:function(){return this.getBytes(this.bytesLeft)},getBytes:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.offset;this.offset=r+t;return this.data.slice(r,this.offset)},setBytes:function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.offset;var e=this.data;e.splice.apply(e,[r,t.length].concat(i(t)));this.data=e;this.offset=r+t.length}};Object.defineProperties(m.prototype,{size:{get:function(){return this.data.length}},isEmpty:{get:function(){if(this.offset>this.data.length){throw new Error("current offset ".concat(this.offset," is outside the bounds of the buffer"))}return this.data.length-this.offset===0}},bytesLeft:{get:function(){return this.data.length-this.offset}},position:{get:function(){return this.offset}}});var F=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var e=0;for(var a in r){if(a in t&&r[a]){e|=t[a]}}return e};var p=function(t,r,e,a){var n=(1<<r)-1<<e-1;var i=a;var v=t;v&=~n;i<<=e-1;v|=i;return v};var Y=80;var H=81;var G=82;var B=83;var V=84;var w=85;var x=86;var b=87;var W=88;var K=89;var X=90;var j=91;var z=255;var Q=Object.freeze({__proto__:null,DATA_REQUEST:Y,DATA_RESPONSE:H,FRAGMENT_REQUEST:X,FRAGMENT_RESPONSE:j,IDENT_REQUEST:G,IDENT_RESPONSE:B,INVALID:z,L2_CHECK_ADDRESS_REQUEST:x,L2_CHECK_ADDRESS_RESPONSE:b,L2_RM_ADDRESS_REQUEST:W,L2_RM_ADDRESS_RESPONSE:K,L2_SET_ADDRESS_REQUEST:V,L2_SET_ADDRESS_RESPONSE:w});var Z=function(t){var r={};for(var e in t){var a=t[e];r[a]=e}return r};Z(Q);var k=0;var q=1;var $=2;var J=3;var tt=Object.freeze({__proto__:null,READ_ONLY:J,READ_WRITE:$,ROOT:q,UNENCRYPTED:k});Z(tt);var rt=0;var et=1;var at=2;var nt=3;var it=4;var vt=5;var Et=6;var _t=7;var st=8;var ot=9;var ft=10;var ut=11;var Tt=12;var At=13;var Rt=14;var Ot=Object.freeze({__proto__:null,CASE_MODULE_OPEN:ft,CASE_OPEN:rt,CASE_TERMINAL_OPEN:ot,DEVICE_FAILURE:st,ERROR_ACCESS:vt,MAGNETIC_ON:et,PARAMETERS_UPDATE_LOCAL:nt,PARAMETERS_UPDATE_REMOTE:at,PROTECTION_RESET_EM:At,PROTECTION_RESET_MAGNETIC:Rt,RESTART:it,TARIFF_TABLE_GET:Tt,TARIFF_TABLE_SET:ut,TIME_CORRECT:_t,TIME_SET:Et});Z(Ot);var dt=1;var ct=3;var lt=4;var Nt=5;var Ut=7;var ht=8;var St=9;var Dt=13;var Lt=15;var It=16;var gt=17;var Ct=18;var Pt=19;var Mt=20;var yt=21;var mt=22;var Ft=23;var pt=24;var Yt=25;var Ht=28;var Gt=30;var Bt=31;var Vt=40;var wt=41;var xt=42;var bt=44;var Wt=45;var Kt=46;var Xt=47;var jt=49;var zt=50;var Qt=51;var Zt=52;var kt=53;var qt=54;var $t=57;var Jt=58;var tr=59;var rr=60;var er=61;var ar=62;var nr=65;var ir=70;var vr=74;var Er=75;var _r=79;var sr=80;var or=82;var fr=83;var ur=88;var Tr=89;var Ar=91;var Rr=92;var Or=93;var dr=94;var cr=100;var lr=109;var Nr=111;var Ur=112;var hr=113;var Sr=114;var Dr=116;var Lr=117;var Ir=118;var gr=122;var Cr=Object.freeze({__proto__:null,activateRatePlan:Pt,getBv:Ur,getCorrectTime:ar,getCriticalEvent:nr,getCurrentStatusMeter:$t,getCurrentValues:Dt,getDateTime:Ut,getDayDemand:mt,getDayDemandExport:_r,getDayMaxDemand:jt,getDayMaxDemandExport:ur,getDayMaxDemandPrevious:vr,getDayProfile:tr,getDemand:Ir,getDemandParameters:Lr,getDeviceId:Nt,getDeviceType:lt,getDisplayParam:dr,getEnergy:Lt,getEnergyDayPrevious:ct,getEnergyExport:Ar,getEnergyExportDayPrevious:sr,getEventStatus:dt,getEvents:Qt,getEventsCounters:Zt,getExtendedCurrentValues:Jt,getExtendedCurrentValues2:Wt,getHalfHourDemand:yt,getHalfHourDemandExport:fr,getHalfHourDemandPrevious:Er,getHalfHourEnergies:Nr,getMagneticFieldThreshold:lr,getMeterInfo:gr,getMonthDemand:Ft,getMonthDemandExport:or,getMonthMaxDemand:zt,getMonthMaxDemandExport:Tr,getOperatorParameters:Gt,getOperatorParametersExtended3:hr,getRatePlanInfo:bt,getSaldo:wt,getSaldoParameters:Kt,getSeasonProfile:rr,getSpecialDay:er,getVersion:Vt,prepareRatePlan:Mt,resetPowerMaxDay:kt,resetPowerMaxMonth:qt,runTariffPlan:ir,setAccessKey:St,setCorrectDateTime:Rr,setCorrectTime:Ht,setDateTime:ht,setDayProfile:It,setDemandParameters:Dr,setDisplayParam:Or,setOperatorParameters:Bt,setOperatorParametersExtended3:Sr,setSaldo:xt,setSaldoParameters:Xt,setSeasonProfile:gt,setSpecialDay:Ct,setSpecialOperation:cr,turnRelayOff:Yt,turnRelayOn:pt});Z(Cr);var Pr=1;var Mr=2;var yr=3;var mr=16;var Fr=17;var pr=18;var Yr=19;var Hr=20;var Gr=21;var Br=32;var Vr=33;var wr=34;var xr=35;var br=36;var Wr=37;var Kr=38;var Xr=39;var jr=40;var zr=41;var Qr=49;var Zr=50;var kr=51;var qr=52;var $r=53;var Jr=54;var te=55;var re=56;var ee=57;var ae=60;var ne=61;var ie=62;var ve=63;var Ee=64;var _e=65;var se=66;var oe=67;var fe=68;var ue=69;var Te=70;var Ae=71;var Re=72;var Oe=73;var de=74;var ce=75;var le=76;var Ne=77;var Ue=78;var he=79;var Se=80;var De=81;var Le=82;var Ie=83;var ge=84;var Ce=85;var Pe=86;var Me=87;var ye=88;var me=89;var Fe=96;var pe=97;var Ye=98;var He=99;var Ge=100;var Be=101;var Ve=102;var we=103;var xe=104;var be=105;var We=112;var Ke=113;var Xe=114;var je=115;var ze=116;var Qe=117;var Ze=118;var ke=119;var qe=120;var $e=121;var Je=122;var ta=123;var ra=124;var ea=125;var aa=126;var na=144;var ia=145;var va=147;var Ea=148;var _a=152;var sa=156;var oa=157;var fa=158;var ua=159;var Ta=160;var Aa=161;var Ra=162;var Oa=176;var da=177;var ca=178;var la=179;var Na=180;var Ua=181;var ha=182;var Sa=183;var Da=185;var La=186;var Ia=224;var ga=225;var Ca=226;var Pa=227;var Ma=228;var ya=229;var ma=230;var Fa=231;var pa=232;var Ya=Object.freeze({__proto__:null,ACCESS_ERROR:Fr,ACCESS_LOCKED:mr,ACC_PARAMETERS_EXT_FAULT:je,ACC_PARAMETERS_FAULT:Xe,BAD_TEST_EEPROM:xe,BAD_TEST_FRAM:be,BATTERY_FAULT:Ie,BATTERY_OK:Le,BIPOLAR_POWER_FAULT:Na,BIPOLAR_POWER_OK:Ua,BLOCK_TARIFF_FAULT:Qe,CALC_PERIOD_FAULT:ze,CALIBRATION_FAULT:Ce,CALIBRATION_FLAG_RESET:we,CALIBRATION_FLAG_SET:Ve,CALIBRATION_OK:ge,CALIBRATION_PARAMETERS_FAULT:Ze,CASE_CLOSED:Yr,CASE_MODULE_CLOSED:ea,CASE_MODULE_OPENED:ra,CASE_OPENED:pr,CASE_TERMINAL_BOX_CLOSED:ta,CASE_TERMINAL_BOX_OPENED:Je,CHANGE_ACCESS_KEY0:Br,CHANGE_ACCESS_KEY1:Vr,CHANGE_ACCESS_KEY2:wr,CHANGE_ACCESS_KEY3:xr,CHANGE_COR_TIME:zr,CHANGE_PARAMETERS_CHANNEL:Da,CHANGE_PARAMETERS_LOCAL:br,CHANGE_PARAMETERS_REMOTE:Wr,CHANGE_TARIFF_TABLE:Zr,CHANGE_TARIFF_TABLE_2:_a,CLOCK_FAULT:Me,CLOCK_OK:Pe,CMD_RELAY_2_OFF:pe,CMD_RELAY_2_ON:Fe,CMD_RELAY_OFF:jr,CMD_RELAY_ON:Xr,CMD_SET_DATETIME:Kr,CROSS_ZERO_EN_T1:Ye,CROSS_ZERO_EN_T2:He,CROSS_ZERO_EN_T3:Ge,CROSS_ZERO_EN_T4:Be,CROSS_ZERO_EXPORT_EN_T1:fa,CROSS_ZERO_EXPORT_EN_T2:ua,CROSS_ZERO_EXPORT_EN_T3:Ta,CROSS_ZERO_EXPORT_EN_T4:Aa,CURRENT_UNEQUAL_FAULT:ca,CURRENT_UNEQUAL_OK:la,EM_MAGNETIC_INFLUENCE_OFF:da,EM_MAGNETIC_INFLUENCE_ON:Oa,ENERGY_REGISTER_FAULT:Pr,ENERGY_REGISTER_OVERFLOW:Qr,F_MAX_OK:Re,F_MAX_OVER:Oe,F_MIN_OK:de,F_MIN_OVER:ce,I_MAX_OK:le,I_MAX_OVER:Ne,MAGNETIC_INFLUENCE_OFF:Gr,MAGNETIC_INFLUENCE_ON:Hr,OPERATOR_PARAMETERS_VALUES_FAULT:yr,POWER_A_OFF:ye,POWER_A_ON:me,POWER_B_OFF:ne,POWER_B_ON:ae,POWER_C_OFF:ve,POWER_C_ON:ie,POWER_GOOD_DIO:aa,POWER_OVER_RELAY_OFF:oa,POWER_SALDO_OK:Se,POWER_SALDO_OVER:De,P_MAX_A_MINUS_OK:Fa,P_MAX_A_MINUS_OVER:pa,P_MAX_OK:Ue,P_MAX_OVER:he,RELAY_HARD_BAD_OFF:na,RELAY_HARD_BAD_ON:va,RELAY_HARD_OFF:Ea,RELAY_HARD_ON:ia,RELAY_OFF:te,RELAY_OFF_BAD_SALDO:La,RELAY_ON:Jr,RESET_EM_FLAG:ha,RESET_MAGNET_FLAG:Sa,RESTART:re,SALDO_EN_FAULT:qe,SALDO_PARAMETERS_FAULT:Ke,SET_DEMAND_EN_10MIN:Pa,SET_DEMAND_EN_15MIN:Ma,SET_DEMAND_EN_1MIN:Ia,SET_DEMAND_EN_30MIN:ya,SET_DEMAND_EN_3MIN:ga,SET_DEMAND_EN_5MIN:Ca,SET_DEMAND_EN_60MIN:ma,SET_NEW_SALDO:We,SET_SALDO_PARAM:sa,SET_TARIFF_TABLE:kr,SUMMER_TIME:qr,TIME_CORRECT:$e,TIME_CORRECT_NEW:Ra,T_MAX_OK:fe,T_MAX_OVER:ue,T_MIN_OK:Te,T_MIN_OVER:Ae,VENDOR_PAR_FAULT:Mr,V_MAX_OK:Ee,V_MAX_OVER:_e,V_MIN_OK:se,V_MIN_OVER:oe,WATCHDOG_RESTART:ee,WINTER_SUMMER_FAULT:ke,WINTER_TIME:$r});Z(Ya);var Ha=0;var Ga=128;var Ba=129;var Va=130;var wa=131;var xa=132;var ba=133;var Wa=134;var Ka=135;var Xa=136;var ja=137;var za=144;var Qa=145;var Za=146;var ka=147;var qa=149;var $a=151;var Ja=152;var tn=153;var rn=154;var en=155;var an=156;var nn=159;var vn=160;var En=240;var _n=Object.freeze({__proto__:null,ACCESS_DENIED:ka,BAD_ARRAY_INDEX:Wa,BAD_BLOCK_NUMBER:an,BAD_DATA_LENGTH:ba,BAD_MESSAGE:xa,BAD_RATE_PLAN_ID:Xa,BAD_RATE_PLAN_SIZE:ja,BAD_RESPONSE_LENGTH:za,BAD_SALDO_WRITE:qa,BLOCKED_METER:$a,CALIBRATION_DISABLED:Za,DECRYPTION_FAILURE:Va,INTERNAL:En,INVALID_CORRECTION_INTERVAL:rn,NOT_ALIGNED_DATA:Ba,NOT_PREPARED_RATE_PLAN:Ka,NO_DATA_FOR_DATE:Qa,OK:Ha,OUT_OFF_RANGE:nn,SET_METER_TYPE_FAILURE:vn,TIME_CORRECTION_FAILURE:tn,TIME_CORRECTION_OUT_HALF_HOUR_DISABLED:en,UNENCRYPTED_COMMAND_DISABLED:Ja,UNKNOWN_COMMAND:Ga,UNKNOWN_PROTOCOL:wa});Z(_n);var sn=1;var on=2;var fn=3;var un=4;var Tn=5;var An=6;var Rn=7;var On=8;var dn=9;var cn=10;var ln=11;var Nn=12;var Un=13;var hn=14;var Sn=15;var Dn=16;var Ln=17;var In=18;var gn=19;var Cn=20;var Pn=21;var Mn=22;var yn=23;var mn=24;var Fn=25;var pn=26;var Yn=28;var Hn=30;var Gn=31;var Bn=Object.freeze({__proto__:null,ACTIVE_ENERGY_T1:un,ACTIVE_ENERGY_T2:Tn,ACTIVE_ENERGY_T3:An,ACTIVE_ENERGY_T4:Rn,ACTIVE_POWER_IN_NEUTRAL:dn,ACTIVE_POWER_PER_PHASE:On,BATTERY_VOLTAGE:Mn,CURRENT_BALANCE:Hn,CURRENT_IN_NEUTRAL:ln,CURRENT_IN_PHASE:cn,DATE_MONTH_YEAR:hn,EXPORTED_ACTIVE_ENERGY_T1:Dn,EXPORTED_ACTIVE_ENERGY_T2:Ln,EXPORTED_ACTIVE_ENERGY_T3:In,EXPORTED_ACTIVE_ENERGY_T4:gn,HOUR_MINUTE_SECOND:Un,MAGNET_INDUCTION:Yn,OPTOPORT_SPEED:Gn,POWER_FACTOR_PHASE_A:Cn,POWER_FACTOR_PHASE_B:Pn,POWER_THRESHOLD_T1:yn,POWER_THRESHOLD_T2:mn,POWER_THRESHOLD_T3:Fn,POWER_THRESHOLD_T4:pn,SET_ALL_SEGMENT_DISPLAY:sn,SOFTWARE_VERSION:on,TOTAL_ACTIVE_ENERGY:fn,TOTAL_EXPORTED_ACTIVE_ENERGY:Sn,VOLTAGE:Nn});Z(Bn);var Vn=120;var wn=121;var xn=254;var bn=255;var Wn=Object.freeze({__proto__:null,activateRatePlan:Pt,errorDataFrameResponse:bn,errorResponse:xn,getBv:Ur,getCorrectTime:ar,getCriticalEvent:nr,getCurrentStatusMeter:$t,getCurrentValues:Dt,getDateTime:Ut,getDayDemand:mt,getDayDemandExport:_r,getDayEnergies:Vn,getDayMaxDemand:jt,getDayMaxDemandExport:ur,getDayMaxDemandPrevious:vr,getDayMaxPower:wn,getDayProfile:tr,getDemand:Ir,getDemandParameters:Lr,getDeviceId:Nt,getDeviceType:lt,getDisplayParam:dr,getEnergy:Lt,getEnergyDayPrevious:ct,getEnergyExport:Ar,getEnergyExportDayPrevious:sr,getEventStatus:dt,getEvents:Qt,getEventsCounters:Zt,getExtendedCurrentValues:Jt,getExtendedCurrentValues2:Wt,getHalfHourDemand:yt,getHalfHourDemandExport:fr,getHalfHourDemandPrevious:Er,getHalfHourEnergies:Nr,getMagneticFieldThreshold:lr,getMeterInfo:gr,getMonthDemand:Ft,getMonthDemandExport:or,getMonthMaxDemand:zt,getMonthMaxDemandExport:Tr,getOperatorParameters:Gt,getOperatorParametersExtended3:hr,getRatePlanInfo:bt,getSaldo:wt,getSaldoParameters:Kt,getSeasonProfile:rr,getSpecialDay:er,getVersion:Vt,prepareRatePlan:Mt,resetPowerMaxDay:kt,resetPowerMaxMonth:qt,runTariffPlan:ir,setAccessKey:St,setCorrectDateTime:Rr,setCorrectTime:Ht,setDateTime:ht,setDayProfile:It,setDemandParameters:Dr,setDisplayParam:Or,setOperatorParameters:Bt,setOperatorParametersExtended3:Sr,setSaldo:xt,setSaldoParameters:Xt,setSeasonProfile:gt,setSpecialDay:Ct,setSpecialOperation:cr,turnRelayOff:Yt,turnRelayOn:pt});Z(Wn);var Kn=2400;var Xn=9600;var jn={rs485orTwi:{0:Xn,2:Kn,4:Xn},optoport:{0:Kn,2:Kn,4:Xn}};var zn={rs485orTwi:Z(jn.rs485orTwi),optoport:Z(jn.optoport)};var Qn=11;var Zn=74;var kn=7;var qn=2+kn;var $n={SET_ALL_SEGMENT_DISPLAY:1,SOFTWARE_VERSION:2,TOTAL_ACTIVE_ENERGY:4,ACTIVE_ENERGY_T1:8,ACTIVE_ENERGY_T2:16,ACTIVE_ENERGY_T3:32,ACTIVE_ENERGY_T4:64,ACTIVE_POWER_PER_PHASE:128,ACTIVE_POWER_IN_NEUTRAL:256,CURRENT_IN_PHASE:512,CURRENT_IN_NEUTRAL:1024,VOLTAGE:2048,HOUR_MINUTE_SECOND:4096,DATE_MONTH_YEAR:8192,TOTAL_EXPORTED_ACTIVE_ENERGY:16384,EXPORTED_ACTIVE_ENERGY_T1:32768,EXPORTED_ACTIVE_ENERGY_T2:65536,EXPORTED_ACTIVE_ENERGY_T3:131072,EXPORTED_ACTIVE_ENERGY_T4:262144,POWER_FACTOR_PHASE_A:524288,POWER_FACTOR_PHASE_B:1048576,BATTERY_VOLTAGE:2097152,POWER_THRESHOLD_T1:4194304,POWER_THRESHOLD_T2:8388608,POWER_THRESHOLD_T3:16777216,POWER_THRESHOLD_T4:33554432,CURRENT_BALANCE:536870912};var Jn={...$n,AUTO_SCREEN_SCROLLING:2147483648};var ti={...$n,MAGNET_INDUCTION:134217728,OPTOPORT_SPEED:1073741824,SORT_DISPLAY_SCREENS:2147483648};var ri={RELAY_ON_Y:1,RELAY_ON_CENTER:2,RELAY_ON_PB:4,RELAY_ON_TARIFF_1:8,RELAY_ON_TARIFF_2:16,RELAY_ON_TARIFF_3:32,RELAY_ON_TARIFF_4:64,RELAY_ON_V_GOOD:128};var ei={RELAY_OFF_Y:1,RELAY_OFF_CENTER:2,RELAY_OFF_TARIFF_1:4,RELAY_OFF_TARIFF_2:8,RELAY_OFF_TARIFF_3:16,RELAY_OFF_TARIFF_4:32,RELAY_OFF_I_LIMIT:64,RELAY_OFF_V_BAD:128};var ai={RELAY_OFF_LIM_TARIFF_1:2,RELAY_OFF_LIM_TARIFF_2:4,RELAY_OFF_LIM_TARIFF_3:8,RELAY_OFF_LIM_TARIFF_4:16,RELAY_OFF_PF_MIN:32};var ni={RELAY_ON_TIMEOUT:1,RELAY_ON_SALDO:2,RELAY_OFF_SALDO:4,RELAY_OFF_SALDO_SOFT:8,RELAY_OFF_MAGNET:16,RELAY_ON_MAGNET_TIMEOUT:32,RELAY_ON_MAGNET_AUTO:64};var ii={RELAY_OFF_UNEQUAL_CURRENT:1,RELAY_ON_UNEQUAL_CURRENT:2,RELAY_OFF_BIPOLAR_POWER:4,RELAY_ON_BIPOLAR_POWER:8};var vi={BLOCK_KEY_OPTOPORT:2,MAGNET_SCREEN_CONST:32};var Ei={RELAY_OFF_LIMIT_P_MINUS_T1:8,RELAY_OFF_LIMIT_P_MINUS_T2:16,RELAY_OFF_LIMIT_P_MINUS_T3:32,RELAY_OFF_LIMIT_P_MINUS_T4:64};var _i=function(t){var r=0;r=p(r,4,1,Number(zn.rs485orTwi[t.rs485orTwi]));r=p(r,4,5,Number(zn.optoport[t.optoport]));return r};var si=function(t){var r=0;r=p(r,2,1,t.tariff);r=p(r,1,3,+!t.isFirstHalfHour);r=p(r,5,4,t.hour);return r};var oi=function(t,r){t.setUint8(r.isSummerTime?1:0);t.setUint8(r.seconds);t.setUint8(r.minutes);t.setUint8(r.hours);t.setUint8(r.day||0);t.setUint8(r.date);t.setUint8(r.month);t.setUint8(r.year)};var fi=function(t,r){t.setUint32(r.id);t.setUint8(r.tariffSet);t.setUint8(r.activateYear);t.setUint8(r.activateMonth);t.setUint8(r.activateDay);t.setUint8(r.specialProfilesArraySize);t.setUint8(r.seasonProfilesArraySize);t.setUint8(r.dayProfilesArraySize)};var ui=function(t,r){t.setUint8(r.monthTransitionSummer);t.setUint8(r.dateTransitionSummer);t.setUint8(r.hoursTransitionSummer);t.setUint8(r.hoursCorrectSummer);t.setUint8(r.monthTransitionWinter);t.setUint8(r.dateTransitionWinter);t.setUint8(r.hoursTransitionWinter);t.setUint8(r.hoursCorrectWinter);t.setUint8(+r.isCorrectionNeeded)};var Ti=function(t,r){t.setUint8(si(r))};var Ai=function(t,r){t.setUint8(r.month);t.setUint8(r.date);r.dayIndexes.forEach(function(r){return t.setUint8(r)})};var Ri=function(t,r){t.setUint8(r.month);t.setUint8(r.date);t.setUint8(r.dayIndex);t.setUint8(r.year)};var Oi=function(t,r){var e=r.timeCorrectPeriod|(r.timeCorrectPassHalfhour?128:0);t.setUint32(r.vpThreshold);t.setUint32(r.vThreshold);t.setUint32(r.ipThreshold);t.setUint32(r.pmaxThreshold0);t.setUint32(r.pmaxThreshold1);t.setUint32(r.pmaxThreshold2);t.setUint32(r.pmaxThreshold3);t.setUint8(_i(r.serialPortsSpeed));t.setUint8(r.tint);t.setUint8(r.calcPeriodDate);t.setUint8(r.timeoutDisplay);t.setUint8(r.timeoutScreen);t.setUint32(F(Jn,r.displaySet));t.setUint8(F(ni,r.relaySet4));t.setUint8(F(ai,r.relaySet3));t.setUint8(F(ei,r.relaySet2));t.setUint8(F(ri,r.relaySet1));t.setUint8(r.displayType);t.setUint8(r.ten);t.setUint16(r.timeoutRefresh);t.setUint8(r.deltaCorMin);t.setUint8(r.timeoutMagnetOff);t.setUint8(r.timeoutMagnetOn);t.setUint8(F(vi,r.define1));t.setUint8(r.timeoutRelayOn);t.setUint8(r.timeoutRelayKey);t.setUint8(r.timeoutRelayAuto);t.setUint8(r.timeoutBadVAVB);t.setUint8(r.freqMax);t.setUint8(r.freqMin);t.setUint16(r.phMin);t.setUint8(r.year);t.setUint8(r.month);t.setUint8(r.date);t.setUint8(r.energyDecimalPoint);t.setUint8(r.typeMeter);t.setUint8(r.timeoutIMax);t.setUint8(r.timeoutPMax);t.setUint8(r.timeoutCos);t.setUint8(r.pMaxDef);t.setUint32(F(ti,r.displaySetExt));t.setUint8(r.timeoutUneqCurrent);t.setUint8(r.timeoutBipolarPower);t.setUint8(F(ii,r.relaySet5));t.setUint8(e)};var di=function(t,r){t.setUint8(r.year);t.setUint8(r.month);t.setUint8(r.date)};var ci=function(t,r){r.coefficients.forEach(function(r){return t.setUint32(r)});t.setUint8(r.decimalPointTariff);t.setInt32(r.indicationThreshold);t.setInt32(r.relayThreshold);t.setUint8(r.mode);t.setUint8(r.saldoOffTimeBegin);t.setUint8(r.saldoOffTimeEnd);t.setUint8(r.decimalPointIndication);t.setUint32(r.powerThreshold);t.setInt32(r.creditThreshold)};var li=function(t,r){var e=r.date.year<<1|r.date.month>>3&1;var a=r.date.month<<5&224|r.date.date&31;t.setUint8(e);t.setUint8(a);t.setUint8(r.demandType);t.setUint16(r.firstIndex);t.setUint8(r.count);t.setUint8(r.period)};var Ni=function(t,r){t.setUint8(r.channelParam1);t.setUint8(r.counterInterval);t.setUint8(r.channelParam2);t.setUint8(0)};var Ui=function(t,r){var e=r.pmaxMinusThreshold0,a=r.pmaxMinusThreshold1,n=r.pmaxMinusThreshold2,i=r.pmaxMinusThreshold3,v=r.relaySet;t.setUint32(e);t.setUint32(a);t.setUint32(n);t.setUint32(i);t.setUint8(F(Ei,v))};var hi=function(t){return btoa(t.map(function(t){return String.fromCharCode(t)}).join(""))};var Si=function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return[t,r.length].concat(i(r))};var Di=Pt;var Li=1+Qn;var Ii=function(t){var r=new m(Li,false);r.setUint8(t.tariffTable);fi(r,t.tariffPlan);return Si(Di,r.data)};var gi=Ur;var Ci=function(){return Si(gi)};var Pi=ar;var Mi=function(){return Si(Pi)};var yi=nr;var mi=function(t){return Si(yi,[t.event,t.index])};var Fi=$t;var pi=function(){return Si(Fi)};var Yi=Dt;var Hi=function(){return Si(Yi)};var Gi=Ut;var Bi=function(){return Si(Gi)};var Vi=3;var wi=4;var xi=mt;var bi=function(t){var r=new m(t?.energyType?wi:Vi);di(r,t?.date);if(t?.energyType){r.setUint8(t.energyType)}return Si(xi,r.data)};var Wi=3;var Ki=4;var Xi=_r;var ji=function(t){var r=new m(t?.energyType?Ki:Wi,false);di(r,t?.date);if(t?.energyType){r.setUint8(t.energyType)}return Si(Xi,r.data)};var zi=jt;var Qi=3;var Zi=function(t){var r=new m(Qi,false);di(r,t.date);return Si(zi,r.data)};var ki=ur;var qi=3;var $i=function(t){var r=new m(qi,false);di(r,t.date);return Si(ki,r.data)};var Ji=vr;var tv=function(){return Si(Ji)};var rv=tr;var ev=3;var av=function(t){var r=new m(ev,false);r.setUint8(t.tariffTable);r.setUint8(t.index);r.setUint8(t.isActive?0:1);return Si(rv,r.data)};var nv=Ir;var iv=7;var vv=function(t){var r=new m(iv,false);li(r,t);return Si(nv,r.data)};var Ev=Lr;var _v=function(){return Si(Ev)};var sv=Nt;var ov=function(){return Si(sv)};var fv=lt;var uv=function(){return Si(fv)};var Tv=dr;var Av=1;var Rv=function(t){var r=new m(Av,false);r.setUint8(t.displayMode);return Si(Tv,r.data)};var Ov=0;var dv=1;var cv=Lt;var lv=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=new m(t?.energyType?dv:Ov,false);if(t?.energyType){r.setUint8(t.energyType)}return Si(cv,r.data)};var Nv=ct;var Uv=function(t){if(t.energyType){return Si(Nv,[t.energyType])}return Si(Nv)};var hv=0;var Sv=1;var Dv=Ar;var Lv=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=new m(t?.energyType?Sv:hv,false);if(t?.energyType){r.setUint8(t.energyType)}return Si(Dv,r.data)};var Iv=sr;var gv=function(t){if(t.energyType){return Si(Iv,[t.energyType])}return Si(Iv)};var Cv=Qt;var Pv=4;var Mv=function(t){var r=new m(Pv,false);di(r,t.date);r.setUint8(t.offset);return Si(Cv,r.data)};var yv=Zt;var mv=function(){return Si(yv)};var Fv=dt;var pv=function(){return Si(Fv)};var Yv=Jt;var Hv=function(){return Si(Yv)};var Gv=Wt;var Bv=function(){return Si(Gv)};var Vv=yt;var wv=3;var xv=function(t){var r=new m(wv,false);di(r,t.date);return Si(Vv,r.data)};var bv=fr;var Wv=3;var Kv=function(t){var r=new m(Wv,false);di(r,t.date);return Si(bv,r.data)};var Xv=Er;var jv=function(){return Si(Xv)};var zv={"A+":1,"A+R+":2,"A+R-":4,"A-":8,"A-R+":16,"A-R-":32};var Qv=function(t){var r={};Object.keys(t).forEach(function(e){r[e]=!!t[e]});return F(zv,r)};var Zv=function(t,r){var e=r.year,a=r.month,n=r.date;var i=e<<1|a>>3&1;var v=a<<5&224|n&31;t.setUint8(i);t.setUint8(v)};var kv=function(t,r){t.setUint8(Qv(r))};var qv=Nr;var $v=5;var Jv=function(t){var r=new m($v,false);Zv(r,t.date);kv(r,t.energies);r.setUint8(t.firstHalfhour);r.setUint8(t.halfhoursNumber);return Si(qv,r.data)};var tE=lr;var rE=function(){return Si(tE)};var eE=gr;var aE=function(){return Si(eE)};var nE=Ft;var iE=2;var vE=function(t){var r=new m(iE,false);r.setUint8(t.year);r.setUint8(t.month);return Si(nE,r.data)};var EE=or;var _E=2;var sE=function(t){var r=new m(_E,false);r.setUint8(t.year);r.setUint8(t.month);return Si(EE,r.data)};var oE=zt;var fE=function(t){var r=t.year,e=t.month;return Si(oE,[r,e])};var uE=Tr;var TE=function(t){var r=t.year,e=t.month;return Si(uE,[r,e])};var AE=Gt;var RE=function(){return Si(AE)};var OE=hr;var dE=function(){return Si(OE)};var cE=bt;var lE=function(t){return Si(cE,[t.tariffTable])};var NE=wt;var UE=function(){return Si(NE)};var hE=Kt;var SE=function(){return Si(hE)};var DE=rr;var LE=3;var IE=function(t){var r=new m(LE,false);r.setUint8(t.tariffTable);r.setUint8(t.index);r.setUint8(t.isActive?0:1);return Si(DE,r.data)};var gE=er;var CE=3;var PE=function(t){var r=new m(CE,false);r.setUint8(t.tariffTable);r.setUint8(t.index);r.setUint8(t.isActive?0:1);return Si(gE,r.data)};var ME=Vt;var yE=function(){return Si(ME)};var mE=Mt;var FE=5;var pE=function(t){var r=new m(FE,false);r.setUint8(t.tariffTable);r.setUint32(t.id);return Si(mE,r.data)};var YE=kt;var HE=function(){return Si(YE)};var GE=qt;var BE=function(){return Si(GE)};var VE=ir;var wE=function(t){return Si(VE,[t.tariffTable])};var xE=16;var bE=St;var WE=1+xE;var KE=function(t){var r=new m(WE,false);r.setUint8(t.accessLevel);r.setBytes(t.key);return Si(bE,r.data)};var XE=Rr;var jE=2;var zE=function(t){var r=new m(jE,false);r.setInt16(t.seconds);return Si(XE,r.data)};var QE=Ht;var ZE=9;var kE=function(t){var r=new m(ZE,false);ui(r,t);return Si(QE,r.data)};var qE=ht;var $E=8;var JE=function(t){var r=new m($E,false);oi(r,t);return Si(qE,r.data)};var t_=8;var r_=255;var e_=It;var a_=function(t){var r=t.periods.length<t_;var e=2+t.periods.length+ +r;var a=new m(e,false);a.setUint8(t.tariffTable);a.setUint8(t.index);t.periods.forEach(function(t){Ti(a,t)});if(r){a.setUint8(r_)}return Si(e_,a.data)};var n_=Dr;var i_=4;var v_=function(t){var r=new m(i_,false);Ni(r,t);return Si(n_,r.data)};var E_=Or;var __=function(t){return Si(E_,[t.displayMode].concat(i(t.order)))};var s_=Bt;var o_=Zn;var f_=function(t){var r=new m(o_,false);Oi(r,t);return Si(s_,r.data)};var u_=Sr;var T_=17;var A_=function(t){var r=new m(T_,false);Ui(r,t);return Si(u_,r.data)};var R_=xt;var O_=12;var d_=function(t){var r=new m(O_,false);r.setUint8(t.date.month);r.setUint8(t.date.date);r.setUint8(t.date.hours);r.setUint8(t.date.minutes);r.setInt32(t.saldoNew);r.setInt32(t.saldoOld);return Si(R_,r.data)};var c_=Xt;var l_=37;var N_=function(t){var r=new m(l_,false);ci(r,t);return Si(c_,r.data)};var U_=gt;var h_=qn;var S_=function(t){var r=new m(h_,false);r.setUint8(t.tariffTable);r.setUint8(t.index);Ai(r,t);return Si(U_,r.data)};var D_=Ct;var L_=6;var I_=function(t){var r=new m(L_,false);r.setUint8(t.tariffTable);r.setUint8(t.index);Ri(r,t);return Si(D_,r.data)};var g_=cr;var C_=2;var P_=function(t){var r=new m(C_,false);var e=0;if(t.readScreensInfo){e|=128}if(t.resetElectroMagneticIndication){e|=1}if(t.resetMagneticIndication){e|=2}r.setUint8(t.type);r.setUint8(e);return Si(g_,r.data)};var M_=Yt;var y_=function(){return Si(M_)};var m_=pt;var F_=function(){return Si(m_)};var p_=bn;var Y_={encrypt:function(){},decrypt:function(){}};var H_=function(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:85;var e=r;t.forEach(function(t){e^=t});return e};var G_=e(e(e(e({},k,0),J,1),$,2),q,3);var B_=function(t){var r=J;t.forEach(function(t){var e;if("accessLevel"in t){e=t.accessLevel}if("command"in t){e=t.command.accessLevel}if(G_[e]>G_[r]){r=e}});return r};var V_=16;var w_=[0];var x_=function(t){return function(r,e){var a=e.messageId,n=a===void 0?1:a,v=e.accessLevel,E=v===void 0?B_(r):v,_=e.aesKey;var s=r.flatMap(function(r){if("id"in r){return t[r.id](r.parameters||{})}if("command"in r){return r.command.bytes}throw new Error("wrong command format")});var o=E|16;var f=[n,o];var u=r.length===1&&"id"in r[0]&&r[0].id===p_;if(u){return f.concat(s)}var T=[].concat(o,s,w_);if(E!==k){var A=(T.length+1)%V_;if(A){T=T.concat(new Array(V_-A).fill(0))}}T=T.concat(H_(T));if(_&&E!==k){T=i(Y_.encrypt(_,T))}return f.concat(T)}};var b_={};var W_=x_(b_);b_[Di]=Ii;b_[gi]=Ci;b_[Pi]=Mi;b_[yi]=mi;b_[Fi]=pi;b_[Yi]=Hi;b_[Gi]=Bi;b_[xi]=bi;b_[Xi]=ji;b_[zi]=Zi;b_[ki]=$i;b_[Ji]=tv;b_[rv]=av;b_[nv]=vv;b_[Ev]=_v;b_[sv]=ov;b_[fv]=uv;b_[Tv]=Rv;b_[cv]=lv;b_[Nv]=Uv;b_[Dv]=Lv;b_[Iv]=gv;b_[Cv]=Mv;b_[yv]=mv;b_[Fv]=pv;b_[Yv]=Hv;b_[Gv]=Bv;b_[Vv]=xv;b_[bv]=Kv;b_[Xv]=jv;b_[qv]=Jv;b_[tE]=rE;b_[eE]=aE;b_[nE]=vE;b_[EE]=sE;b_[oE]=fE;b_[uE]=TE;b_[AE]=RE;b_[OE]=dE;b_[cE]=lE;b_[NE]=UE;b_[hE]=SE;b_[DE]=IE;b_[gE]=PE;b_[ME]=yE;b_[mE]=pE;b_[YE]=HE;b_[GE]=BE;b_[VE]=wE;b_[bE]=KE;b_[XE]=zE;b_[QE]=kE;b_[qE]=JE;b_[e_]=a_;b_[n_]=v_;b_[E_]=__;b_[s_]=f_;b_[u_]=A_;b_[R_]=d_;b_[c_]=N_;b_[U_]=S_;b_[D_]=I_;b_[g_]=P_;b_[M_]=y_;b_[m_]=F_;var K_=145;var X_=30;var j_=function(t){var r=[X_,t.length+2,0,K_].concat(i(t));return[].concat(i(r),[H_(r)])};toBytes=W_;getBase64FromBytes=hi;setDataSegment=j_})();
//#endregion


/*
  Incoming arguments:
    * msg - JSON message payload downlink message json
    * msgType - type of message, for ex. 'ATTRIBUTES_UPDATED', 'POST_TELEMETRY_REQUEST', etc.
    * metadata - list of key-value pairs with additional data about the message
    * integrationMetadata - list of key-value pairs with additional data defined in Integration executing this converter

  Output must be an object with the following fields:
    * contentType - BINARY
    * data - payload in base64
*/

var bytes = toBytes(msg.commands);

// send nothing if not fit in a single data segment
if ( bytes.length > MAX_DATA_SEGMENT_SIZE ) {
    bytes = [];
} else {
    bytes = setDataSegment(bytes);
}

var result = {
    contentType: 'BINARY',
    data: getBase64FromBytes(bytes)
};

return result;
